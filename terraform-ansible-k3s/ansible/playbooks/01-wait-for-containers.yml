---
- name: Wait for containers to be ready
  hosts: all
  gather_facts: no
  become: no
  tasks:
    - name: Wait for SSH to be available
      wait_for:
        host: "{{ ansible_host }}"
        port: 22
        delay: 10
        timeout: 300
      delegate_to: localhost
      become: no

    - name: Wait for cloud-init to complete
      command: cloud-init status --wait
      register: cloud_init_result
      failed_when: false
      changed_when: false

    - name: Wait for network connectivity
      wait_for:
        host: "{{ ansible_host }}"
        port: 22
        delay: 5
        timeout: 60
      delegate_to: localhost
      become: no

    - name: Test connectivity
      ping:
